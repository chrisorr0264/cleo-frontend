{% extends 'base.html' %} {% load static %} {% block title %}Edit Mode - {{
media.orig_name }}{% endblock %} {% block content %}
<!-- Uniquely identify this page. -->
<div id="edit-media-identifier" style="display: none"></div>

<div class="container-fluid p-0">
    <div class="row no-gutters">
        <!-- Column 1: Image and Bottom Section -->
        <div class="col-md-9 p-2">
            <!-- Row 1: Image -->
            <div id="image-container" style="position: relative">
                <img
                    id="media-image"
                    src="{{ media.full_path }}"
                    alt="{{ media.orig_name }}"
                    style="width: auto; height: auto"
                    data-media-id="{{ media.media_object_id }}"
                />

                <!-- Loading indicator-->
                <div id="loading-indicator" class="loading-container">
                    <div class="loading-text">
                        <span>P</span><span>R</span><span>O</span><span>C</span
                        ><span>E</span><span>S</span><span>S</span><span>I</span
                        ><span>N</span><span>G</span>
                    </div>
                </div>

                <div
                    id="edit-buttons"
                    style="position: absolute; bottom: 10px; right: 10px"
                >
                    <button
                        onclick="window.rotateImage('{{ media.media_object_id }}', -90)"
                        class="btn btn-secondary"
                    >
                        <i class="fas fa-undo"></i>
                    </button>
                    <button
                        onclick="window.rotateImage('{{ media.media_object_id }}', 90)"
                        class="btn btn-secondary"
                    >
                        <i class="fas fa-redo"></i>
                    </button>
                    <button
                        onclick="window.saveImage()"
                        class="btn btn-primary"
                    >
                        <i class="fas fa-save"></i>
                    </button>
                </div>
            </div>

            <!-- Row 2: Image Data and Map -->
            <div class="row mt-4">
                <div class="col-md-6">
                    <h4>Image Data</h4>
                    <p>
                        <strong>Filename:</strong> {{ media.new_name }}<br />
                        <strong>Date Created:</strong>
                        <span id="date-display">{{ media.media_create_date|default:"Unknown" }}</span>
                        <span id="date-edit" style="display:none;">
                            <input type="number" id="year-input" class="form-control d-inline-block" style="width: 70px;" placeholder="YYYY" min="1900" max="2100">
                            <input type="number" id="month-input" class="form-control d-inline-block" style="width: 50px;" placeholder="MM" min="1" max="12">
                            <input type="number" id="day-input" class="form-control d-inline-block" style="width: 50px;" placeholder="DD" min="1" max="31">
                        </span>
                        <a href="javascript:void(0);" id="date-lock-toggle">
                            <i id="lock-icon" class="fas fa-lock"></i>
                        </a>
                    </p>
                </div>

                <div class="col-md-6">
                    <h4>Location Data</h4>
                    <p>
                        <strong>Location:</strong> {{ media.location_name }}<br />
                        <strong>City:</strong> {{ media.location_city }}<br />
                        <strong>Province:</strong> {{ media.location_province }}<br />
                        <strong>Country:</strong> {{ media.location_country }}<br />
                        <strong>Lat/Long:</strong> {{ media.latitude|floatformat:3 }}, {{ media.longitude|floatformat:3 }}
                    </p>
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-md-12">
                    <div id="map" style="height: 200px; background-color: #f0f0f0" data-media-id="{{ media.media_object_id }}">
                        <p>Map will be displayed here.</p>
                    </div>
                </div>
            </div>
        </div>
        <!-- Column 2: Editing Tools -->
        <div class="col-md-3 p-2">
            <h4>Edit Tools</h4>

            <div class="text-center mb-4">
                {% if user.is_superuser %}
                <form
                    method="POST"
                    action="{% url 'media:delete_image' media.media_object_id %}"
                >
                    {% csrf_token %}
                    <button
                        id="delete-button"
                        data-media-id="{{ media.media_object_id }}"
                        class="btn btn-danger mb-4"
                    >
                        Delete
                    </button>
                </form>
                {% endif %}
            </div>

            <div class="mb-4">
                <h5>Add Tags</h5>
                <div class="row">
                    <div class="col-5">
                        <h6>Added Tags</h6>
                        <select
                            id="assigned-tags"
                            class="list-group"
                            multiple
                            size="10"
                        >
                            <!-- Assigned tags will be populated here -->
                        </select>
                    </div>
                    <div
                        class="col-2 text-center d-flex flex-column justify-content-center align-items-center"
                    >
                        <button
                            id="moveAllLeftBtn"
                            class="btn btn-secondary mb-2"
                        >
                            <i class="fas fa-angle-double-left"></i>
                        </button>
                        <button
                            id="moveOneLeftBtn"
                            class="btn btn-secondary mb-2"
                        >
                            <i class="fas fa-angle-left"></i>
                        </button>
                        <button
                            id="moveOneRightBtn"
                            class="btn btn-secondary mb-2"
                        >
                            <i class="fas fa-angle-right"></i>
                        </button>
                        <button
                            id="moveAllRightBtn"
                            class="btn btn-secondary mb-2"
                        >
                            <i class="fas fa-angle-double-right"></i>
                        </button>
                    </div>
                    <div class="col-5">
                        <h6>Available Tags</h6>
                        <select
                            id="available-tags"
                            class="list-group"
                            multiple
                            size="10"
                        >
                            <!-- Available tags will be populated here -->
                        </select>
                    </div>
                </div>
                <div class="mt-4 text-center">
                    <!--
                    <button id="updateTagsBtn" class="btn btn-primary mb-2">Update Tags</button>
                    <button id="resetTagsBtn" class="btn btn-secondary mb-2">Reset</button>
                    -->
                    <button id="manageTagsButton" class="btn but-warning mb-2">
                        Manage Tags
                    </button>
                </div>
            </div>

            <div class="mb-4">
                <h5>Search Faces</h5>
                <div>
                    <h6>Assigned Faces</h6>
                    <ul id="assigned-faces" class="form-control" size="5" multiple>
                        {% for face in face_matches %}
                        <option value="{{ face.face_name }}">{{ face.face_name }}</option>
                        {% endfor %}
                    </ul>
                </div>
                <div class="mb-2">
                    <button
                        id="toggle-all-faces"
                        class="btn btn-secondary mb-2"
                    >
                        Show All Faces
                    </button>
                    <button
                        id="toggle-identified-faces"
                        class="btn btn-secondary mb-2"
                    >
                        Show Identified Faces
                    </button>
                </div>
                <button id="search-faces" class="btn btn-warning mb-2">
                    Search Faces
                </button>
                <button id="clear-face-boxes" class="btn btn-danger mb-2">
                    Clear Face Boxes
                </button>
                <div class="mb-4">
                    <h6>Manual Face Recognition</h6>
                    <button
                        id="enable-manual-drawing"
                        class="btn btn-warning mb-2"
                    >
                        Enable Drawing
                    </button>
                    <button
                        id="process-manual-faces"
                        class="btn btn-primary mb-2"
                    >
                        Process Drawn Faces
                    </button>
                </div>
            </div>

            <div class="mb-4">
                <h5>Download Image</h5>
                <div>
                    <!-- Download Functionality -->
                    <a
                        href="{% url 'media:download_image' media.media_object_id %}"
                        class="btn btn-primary"
                        >Download Image</a
                    >
                </div>
            </div>

            <div class="mb-4">
                {% if user.is_superuser %}
                <h5>Hidden Images</h5>
                <div class="slider-container">
                    <input
                        type="checkbox"
                        data-media-id="{{ media.media_object_id }}"
                        class="slider-toggle"
                        id="toggleSecret"
                        {% if media.is_secret %}
                            checked
                        {% endif %}
                    />
                </div>
                {% endif %}
            </div>

            <!-- Close Icon Button -->
            <button
                id="closeButton"
                data-url="{% url 'media:gallery' %}"
                class="btn btn-secondary close-button"
            >
                <i class="fas fa-times"></i>
            </button>
        </div>
    </div>
    <!-- Manage Tags Modal -->
    <div
        class="modal fade"
        id="manageTagsModal"
        tabindex="-1"
        role="dialog"
        aria-labelledby="manageTagsModalLabel"
        aria-hidden="true"
    >
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="manageTagsModalLabel">
                        Manage Tags
                    </h5>
                    <button
                        type="button"
                        class="close"
                        data-dismiss="modal"
                        aria-label="Close"
                    >
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <!-- Form to Add/Update Tag -->
                    <form id="tagForm">
                        <div class="form-group">
                            <label for="tagName">Tag Name</label>
                            <input
                                type="text"
                                class="form-control"
                                id="tagName"
                                placeholder="Enter tag name"
                            />
                        </div>
                        <button type="submit" class="btn btn-primary">
                            Save Tag
                        </button>
                    </form>

                    <!-- List of Existing Tags with Delete Options -->
                    <h5 class="mt-4">Existing Tags</h5>
                    <ul id="existingTagsList" class="list-group">
                        <!-- Existing tags will be populated here -->
                    </ul>
                </div>
                <div class="modal-footer">
                    <button
                        type="button"
                        class="btn btn-secondary"
                        data-dismiss="modal"
                    >
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<form method="post" id="rotateForm">{% csrf_token %}</form>
{% endblock %}
